<header class="navbar">
    <div class="navbar-container">
        <div class="navbar-brand">
            <a href="{% url 'home' %}" class="logo">üêæ PetConnect</a>
        </div>

        <nav class="navbar-menu">
            <a href="{% url 'home' %}" class="nav-link">Home</a>
            <a href="{% url 'about' %}" class="nav-link">About</a>
            <a href="{% url 'pet-tips' %}" class="nav-link">Blog</a>

            {% if user.is_authenticated %}
                {% if user.profile.role == 'SHELTER' %}
                    <a href="{% url 'dashboard' %}" class="nav-link">Dashboard</a>
                {% elif user.profile.role == 'ADOPTER' %}
                    <a href="{% url 'my-applications' %}" class="nav-link">My Applications</a>
                {% endif %}
            {% endif %}
        </nav>

        <!-- Search Bar in Navbar -->
        <form method="get" class="navbar-search-form" action="{% url 'home' %}">
            <input type="text" name="search" placeholder="Search by species or breed..." value="{{ request.GET.search }}" class="navbar-search-input">
            <button type="submit" class="navbar-search-btn">Search</button>
        </form>

        <div class="navbar-auth">
            {% if user.is_authenticated %}
                <span class="nav-user">üë§ {{ user.username }}</span>

                <a href="{% url 'logout' %}" id="logout-link" class="nav-link btn-logout">Logout</a>

                <script>
                (function(){
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }

                    const logoutLink = document.getElementById('logout-link');
                    if (!logoutLink) return;

                    logoutLink.addEventListener('click', function(e){
                        e.preventDefault();
                        const url = this.href;
                        fetch(url, {
                            method: 'POST',
                            credentials: 'same-origin',
                            headers: {
                                'X-CSRFToken': getCookie('csrftoken') || getCookie('csrf'),
                                'Accept': 'text/html'
                            }
                        }).then(function(response){
                            if (response.redirected) {
                                window.location.href = response.url;
                            } else {
                                window.location.href = '/';
                            }
                        }).catch(function(){
                            window.location.href = '/';
                        });
                    });
                })();
                </script>
            {% else %}
                <a href="{% url 'login' %}" class="nav-link btn-login">Login</a>
                <a href="{% url 'signup' %}" class="nav-link btn-signup">Sign Up</a>
            {% endif %}
        </div>
    </div>
